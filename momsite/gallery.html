<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Circles of Life Gallery</title>
    <link rel="stylesheet" href="app.css" type="text/css" />
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script src="data.js"></script>
    <!--<script src="http://mrcoles.com/media/js/scroll-sneak.js"></script>-->
    <!--load header-->
    <!--<script>
        $(function () {
            // source: http://stackoverflow.com/a/9003363
            $("#headerDiv").load("header.html");
        });
    </script>-->
</head>
<body>
    <div id="headerDiv"></div>
    <center>
        <div style="max-width:1024px">
            <div id="leftnav"></div>
            <div id="rightnav"></div>
            <div id="centerimage"></div>

            <div id="detailsdiv">
                <h1>Image Title</h1>
                <div>Image Description</div>
            </div>
        </div>
    </center>
</body>
<script>
    //var sneaky = new ScrollSneak(location.hostname);

    //source:  http://stackoverflow.com/a/2880929
    var urlParams;
    (window.onpopstate = function () {
        var match,
            pl = /\+/g,  // Regex for replacing addition symbol with a space
            search = /([^&=]+)=?([^&]*)/g,
            decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
            query = window.location.search.substring(1);

        urlParams = {};
        while (match = search.exec(query))
            urlParams[decode(match[1])] = decode(match[2]);
    })();

    function addImageToDiv(img, div, link, selected) {
        var link_element =
        $('<a/>', {
            'href': link,
            html: $('<img/>', {
                'src': img.fileName,
                'alt': img.getTitle(),
                'class': selected ? "selected" : ""
            })
        });
        link_element.click(function (e) {
            //console.log("scroll is " + $(window).scrollTop());
            //sneaky.sneak();
            if ($(window).scrollTop() > 0) {
                $(link_element).attr('href', function () {
                    return this.href + '&scroll=' + $(window).scrollTop();
                });
            }
        });
        link_element.appendTo(div);


        //<a class="vlightbox1" href="image1.jpg"
        //var img_el = document.createElement('img');
        //img_el.src = img.fileName;
        //img_el.alt = img.getTitle();
        //div.append(img_el);
        return;
    }
    var idstring = location.search;
    var idstringsplit = idstring ? idstring.split("=") : idstring;
    var id = (idstringsplit && idstringsplit.length && idstringsplit.length > 1) ? Number.parseInt(idstringsplit[1]) : 1;
    var img = imgs[id - 1];
    console.log(id);
    console.log(img);
    console.log(imgs);
    var img_el = document.createElement('img');
    img_el.src = img.fileName;
    img_el.alt = img.getTitle();
    $("#centerimage").append(img_el);
    $("#detailsdiv > h1").text(img.getTitle());
    $("#detailsdiv > div").load(img.getDescriptionFileName() + " .MsoNormal",
        function () {
            console.log($("#detailsdiv > div"));
            //alert($("#detailsdiv > div").length)
            //alert($("#detailsdiv > div").html());
            //alert($("#detailsdiv > div").find(".MsoNormal:first-child").html())
            $("#detailsdiv > div").find(".MsoNormal:first-child").remove();
            //var desc = $("#detailsdiv > div").html();
            //desc.replace("“", "\"");
            //desc.replace("’", "'");
            //$("#detailsdiv > div").html(desc);
        });
    //$("#detailsdiv > div").attr("w3-include-html", img.getDescriptionFileName());
    //w3IncludeHTML();
    //.html(img.description);

    for (var index in imgs) {
        var img_id = (Number.parseInt(index) + 1);
        var img = imgs[index];
        addImageToDiv(img, index < 8 ? $("#leftnav") : $("#rightnav"), "gallery.html?id=" + img_id.toString(), img_id === id);
    }

    if (urlParams.scroll) {
        $(window).scrollTop(parseInt(urlParams.scroll));
        console.log("scrolling to " + urlParams.scroll);
    }

    //$("#leftlink").attr("href", "/gallery.html?id=" + (id - 1).toString());
    //$("#rightlink").attr("href", "/gallery.html?id=" + (id + 1).toString());
</script>
</html>
